/*! For license information please see main.e46330af108713b07b2e.js.LICENSE.txt */
(()=>{"use strict";var e=5e3,t=3e3,n="completed",r="normal",a="overdue",i="due-soon",o={ALL:"all",ACTIVE:"active",COMPLETED:"completed",OVERDUE:"overdue"},s={CREATED_DESC:"created-desc",CREATED_ASC:"created-asc",DEADLINE_ASC:"deadline-asc",DEADLINE_DESC:"deadline-desc",NAME_ASC:"name-asc",NAME_DESC:"name-desc",STATUS_ASC:"status-asc",STATUS_DESC:"status-desc"};function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,h(r.key),r)}}function f(e,t,n){return t&&d(e.prototype,t),n&&d(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function h(e){var t=function(e){if("object"!=l(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==l(t)?t:t+""}var p=function(){return f(function e(){u(this,e)},null,[{key:"escapeHtml",value:function(e){if("string"!=typeof e)return"";var t=document.createElement("div");return t.textContent=e,t.innerHTML}},{key:"sanitizeInput",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return"string"!=typeof e?"":e.trim().slice(0,t)}},{key:"isValidDate",value:function(e){return e instanceof Date&&!isNaN(e)}},{key:"formatDate",value:function(e){return this.isValidDate(e)?new Intl.DateTimeFormat("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(e):""}},{key:"debounce",value:function(e,t){var n;return function(){for(var r=this,a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];clearTimeout(n),n=setTimeout(function(){clearTimeout(n),e.apply(r,i)},t)}}},{key:"generateId",value:function(){return Date.now()+Math.random().toString(36).substr(2,9)}},{key:"createElement",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=document.createElement(e);return t&&(r.className=t),Object.entries(n).forEach(function(e){var t,n,a=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i,o,s=[],l=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,a=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw a}}return s}}(t,n)||function(e,t){if(e){if("string"==typeof e)return c(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=a[0],o=a[1];r.setAttribute(i,o)}),r}},{key:"parseTagString",value:function(e){var t=this;return e?e.split(",").map(function(e){return t.sanitizeInput(e,100)}).filter(function(e){return e.length>0}):[]}}])}(),v=function(){return f(function e(){u(this,e),this.events={}},[{key:"on",value:function(e,t){var n=this;return this.events[e]||(this.events[e]=[]),this.events[e].push(t),function(){return n.off(e,t)}}},{key:"emit",value:function(e,t){this.events[e]&&this.events[e].forEach(function(n){try{n(t)}catch(t){console.error("Error in event handler for ".concat(e,":"),t)}})}},{key:"off",value:function(e,t){this.events[e]&&(this.events[e]=this.events[e].filter(function(e){return e!==t}))}},{key:"once",value:function(e,t){var n=this,r=function(a){t(a),n.off(e,r)};this.on(e,r)}}])}(),y=function(){return f(function e(){u(this,e)},null,[{key:"showError",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;this.showAlert("error",t,n)}},{key:"showSuccess",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;this.showAlert("success",e,n)}},{key:"showAlert",value:function(e,t,n){var r="error"===e?"errorAlert":"successAlert",a="error"===e?"errorMessage":"successMessage",i=document.getElementById(r),o=document.getElementById(a);i&&o?(o.textContent=t,i.classList.remove("hidden"),setTimeout(function(){i.classList.add("hidden")},n)):console.warn("Alert elements not found: ".concat(r,", ").concat(a))}},{key:"handleError",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";console.error("Error in ".concat(t,":"),e),this.showError("エラーが発生しました: ".concat(e.message||"不明なエラー"))}}])}(),m=function(){return f(function e(){u(this,e)},null,[{key:"trapFocus",value:function(e){var t=e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),n=t[0],r=t[t.length-1],a=function(e){"Tab"===e.key&&(e.shiftKey?document.activeElement===n&&(e.preventDefault(),null==r||r.focus()):document.activeElement===r&&(e.preventDefault(),null==n||n.focus()))};return e.addEventListener("keydown",a),null==n||n.focus(),function(){e.removeEventListener("keydown",a)}}},{key:"restoreFocus",value:function(e){e&&"function"==typeof e.focus&&e.focus()}}])}();function g(e){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g(e)}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,k(r.key),r)}}function k(e){var t=function(e){if("object"!=g(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=g(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==g(t)?t:t+""}var x=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t.id||p.generateId(),this.text=p.sanitizeInput(t.text||""),this.completed=Boolean(t.completed),this.deadline=t.deadline||null,this.tags=Array.isArray(t.tags)?t.tags.map(function(e){return p.sanitizeInput(e)}):[],this.createdAt=t.createdAt?new Date(t.createdAt):new Date,this.updatedAt=t.updatedAt?new Date(t.updatedAt):new Date}return t=e,s=[{key:"fromJSON",value:function(t){return new e(t)}}],(o=[{key:"update",value:function(e){return Object.assign(this,e),this.updatedAt=new Date,this}},{key:"getStatus",value:function(){if(this.completed)return n;if(!this.deadline)return r;var e=new Date,t=new Date(this.deadline);if(!p.isValidDate(t))return r;var o=(t.getTime()-e.getTime())/36e5;return o<0?a:o<=24?i:r}},{key:"formatDeadline",value:function(){if(!this.deadline)return"";var e=new Date(this.deadline);if(!p.isValidDate(e))return"";var t=new Date,n=e.getTime()-t.getTime();if(n<0)return"期限切れ (".concat(p.formatDate(e),")");if(n<864e5){var r=Math.floor(n/36e5),a=Math.floor(n%36e5/6e4);return"".concat(r,"時間").concat(a,"分後 (").concat(p.formatDate(e),")")}return p.formatDate(e)}},{key:"toggle",value:function(){return this.completed=!this.completed,this.updatedAt=new Date,this}},{key:"isOverdue",value:function(){return this.getStatus()===a}},{key:"isDueSoon",value:function(){return this.getStatus()===i}},{key:"matchesSearch",value:function(e){if(!e)return!0;var t=e.toLowerCase();return this.text.toLowerCase().includes(t)||this.tags.some(function(e){return e.toLowerCase().includes(t)})}},{key:"toJSON",value:function(){return{id:this.id,text:this.text,completed:this.completed,deadline:this.deadline,tags:this.tags,createdAt:this.createdAt.toISOString(),updatedAt:this.updatedAt.toISOString()}}}])&&b(t.prototype,o),s&&b(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,o,s}();function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach(function(t){T(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function T(e,t,n){return(t=I(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,I(r.key),r)}}function I(e){var t=function(e){if("object"!=w(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=w(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==w(t)?t:t+""}function A(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(A=function(){return!!e})()}function j(e){return j=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},j(e)}function O(e,t){return O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},O(e,t)}var D=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t,n){return t=j(t),function(e,t){if(t&&("object"==w(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,A()?Reflect.construct(t,n||[],j(e).constructor):t.apply(e,n))}(this,t)).tasks=new Map,e.nextId=1,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&O(e,t)}(t,e),n=t,(r=[{key:"addTask",value:function(e){var t=new x(S(S({},e),{},{id:this.nextId++}));return this.tasks.set(t.id,t),this.emit("taskAdded",t),this.emit("tasksChanged"),t}},{key:"updateTask",value:function(e,t){var n=this.tasks.get(e);if(!n)throw new Error("Task with id ".concat(e," not found"));return n.update(t),this.emit("taskUpdated",n),this.emit("tasksChanged"),n}},{key:"deleteTask",value:function(e){var t=this.tasks.get(e);if(!t)throw new Error("Task with id ".concat(e," not found"));return this.tasks.delete(e),this.emit("taskDeleted",{id:e,task:t}),this.emit("tasksChanged"),t}},{key:"toggleTask",value:function(e){var t=this.tasks.get(e);if(!t)throw new Error("Task with id ".concat(e," not found"));return t.toggle(),this.emit("taskUpdated",t),this.emit("tasksChanged"),t}},{key:"getTasks",value:function(){return Array.from(this.tasks.values())}},{key:"getTask",value:function(e){return this.tasks.get(e)}},{key:"clearCompleted",value:function(){var e=this,t=Array.from(this.tasks.values()).filter(function(e){return e.completed});return t.forEach(function(t){return e.tasks.delete(t.id)}),t.length>0&&(this.emit("tasksCleared",t),this.emit("tasksChanged")),t.length}},{key:"getAllTags",value:function(){var e=new Set;return this.tasks.forEach(function(t){t.tags.forEach(function(t){return e.add(t)})}),Array.from(e).sort()}},{key:"getCompletedTasks",value:function(){return this.getTasks().filter(function(e){return e.completed})}},{key:"getActiveTasks",value:function(){return this.getTasks().filter(function(e){return!e.completed})}},{key:"getOverdueTasks",value:function(){return this.getTasks().filter(function(e){return e.isOverdue()})}},{key:"getStats",value:function(){var e=this.getTasks(),t=this.getCompletedTasks(),n=this.getOverdueTasks();return{total:e.length,completed:t.length,active:e.length-t.length,overdue:n.length,completionRate:e.length>0?Math.round(t.length/e.length*100):0}}},{key:"exportData",value:function(){return{tasks:this.getTasks().map(function(e){return e.toJSON()}),exportDate:(new Date).toISOString(),version:"1.0.0"}}},{key:"importData",value:function(e){var t=this;try{if(!e.tasks||!Array.isArray(e.tasks))throw new Error("Invalid data format");return this.tasks.clear(),this.nextId=1,e.tasks.forEach(function(e){var n=x.fromJSON(e);t.tasks.set(n.id,n),t.nextId=Math.max(t.nextId,n.id+1)}),this.emit("tasksImported",e.tasks.length),this.emit("tasksChanged"),e.tasks.length}catch(e){throw new Error("Import failed: ".concat(e.message))}}}])&&C(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(v);function L(e){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L(e)}function B(e){return function(e){if(Array.isArray(e))return F(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return F(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?F(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,P(r.key),r)}}function P(e){var t=function(e){if("object"!=L(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=L(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==L(t)?t:t+""}var N=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentFilter=o.ALL,this.currentTagFilter="",this.searchQuery="",this.sortBy=s.CREATED_DESC},t=[{key:"setFilter",value:function(e){if(!Object.values(o).includes(e))throw new Error("Invalid filter type: ".concat(e));return this.currentFilter=e,this}},{key:"setTagFilter",value:function(e){return this.currentTagFilter=this.currentTagFilter===e?"":e,this}},{key:"setSearchQuery",value:function(e){return this.searchQuery=p.sanitizeInput(e),this}},{key:"setSortBy",value:function(e){if(!Object.values(s).includes(e))throw new Error("Invalid sort type: ".concat(e));return this.sortBy=e,this}},{key:"clearFilters",value:function(){return this.currentFilter=o.ALL,this.currentTagFilter="",this.searchQuery="",this}},{key:"filterTasks",value:function(e){var t=this,n=B(e);switch(this.currentFilter){case o.ACTIVE:n=n.filter(function(e){return!e.completed});break;case o.COMPLETED:n=n.filter(function(e){return e.completed});break;case o.OVERDUE:n=n.filter(function(e){return e.isOverdue()})}return this.currentTagFilter&&(n=n.filter(function(e){return e.tags.includes(t.currentTagFilter)})),this.searchQuery&&(n=n.filter(function(e){return e.matchesSearch(t.searchQuery)})),this.sortTasks(n)}},{key:"sortTasks",value:function(e){var t=B(e);switch(this.sortBy){case s.CREATED_ASC:return t.sort(function(e,t){return e.createdAt-t.createdAt});case s.CREATED_DESC:return t.sort(function(e,t){return t.createdAt-e.createdAt});case s.DEADLINE_ASC:return t.sort(function(e,t){return e.deadline||t.deadline?e.deadline?t.deadline?new Date(e.deadline)-new Date(t.deadline):-1:1:0});case s.DEADLINE_DESC:return t.sort(function(e,t){return e.deadline||t.deadline?e.deadline?t.deadline?new Date(t.deadline)-new Date(e.deadline):1:-1:0});case s.NAME_ASC:return t.sort(function(e,t){return e.text.localeCompare(t.text)});case s.NAME_DESC:return t.sort(function(e,t){return t.text.localeCompare(e.text)});case s.STATUS_ASC:return t.sort(function(e,t){return e.completed-t.completed});case s.STATUS_DESC:return t.sort(function(e,t){return t.completed-e.completed});default:return t}}},{key:"getFilterState",value:function(){return{filter:this.currentFilter,tagFilter:this.currentTagFilter,searchQuery:this.searchQuery,sortBy:this.sortBy}}},{key:"setFilterState",value:function(e){return e.filter&&this.setFilter(e.filter),e.tagFilter&&this.setTagFilter(e.tagFilter),e.searchQuery&&this.setSearchQuery(e.searchQuery),e.sortBy&&this.setSortBy(e.sortBy),this}}],t&&M(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function _(e){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_(e)}function H(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function i(n,r,a,i){var l=r&&r.prototype instanceof s?r:s,c=Object.create(l.prototype);return z(c,"_invoke",function(n,r,a){var i,s,l,c=0,u=a||[],d=!1,f={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,n){return i=t,s=0,l=e,f.n=n,o}};function h(n,r){for(s=n,l=r,t=0;!d&&c&&!a&&t<u.length;t++){var a,i=u[t],h=f.p,p=i[2];n>3?(a=p===r)&&(l=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=h&&((a=n<2&&h<i[1])?(s=0,f.v=r,f.n=i[1]):h<p&&(a=n<3||i[0]>r||r>p)&&(i[4]=n,i[5]=r,f.n=p,s=0))}if(a||n>1)return o;throw d=!0,r}return function(a,u,p){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&h(u,p),s=u,l=p;(t=s<2?e:l)||!d;){i||(s?s<3?(s>1&&(f.n=-1),h(s,l)):f.n=l:f.v=l);try{if(c=2,i){if(s||(a="next"),t=i[a]){if(!(t=t.call(i,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(l=TypeError("The iterator does not provide a '"+a+"' method"),s=1);i=e}else if((t=(d=f.n<0)?l:n.call(r,f))!==o)break}catch(t){i=e,s=1,l=t}finally{c=1}}return{value:t,done:d}}}(n,a,i),!0),c}var o={};function s(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(z(t={},r,function(){return this}),t),d=c.prototype=s.prototype=Object.create(u);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,z(e,a,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=c,z(d,"constructor",c),z(c,"constructor",l),l.displayName="GeneratorFunction",z(c,a,"GeneratorFunction"),z(d),z(d,a,"Generator"),z(d,r,function(){return this}),z(d,"toString",function(){return"[object Generator]"}),(H=function(){return{w:i,m:f}})()}function z(e,t,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}z=function(e,t,n,r){if(t)a?a(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var i=function(t,n){z(e,t,function(e){return this._invoke(t,n,e)})};i("next",0),i("throw",1),i("return",2)}},z(e,t,n,r)}function V(e,t,n,r,a,i,o){try{var s=e[i](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,a)}function U(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,R(r.key),r)}}function R(e){var t=function(e){if("object"!=_(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=_(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==_(t)?t:t+""}var G=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.notifiedTasks=new Set,this.intervalId=null,this.permission=this.getPermissionStatus()},t=[{key:"getPermissionStatus",value:function(){return"Notification"in window?Notification.permission:"not-supported"}},{key:"requestPermission",value:(n=H().m(function e(){var t;return H().w(function(e){for(;;)switch(e.n){case 0:if("Notification"in window){e.n=1;break}throw new Error("このブラウザは通知をサポートしていません");case 1:return e.n=2,Notification.requestPermission();case 2:return t=e.v,this.permission=t,"granted"===t&&this.sendTestNotification(),e.a(2,t)}},e,this)}),r=function(){var e=this,t=arguments;return new Promise(function(r,a){var i=n.apply(e,t);function o(e){V(i,r,a,o,s,"next",e)}function s(e){V(i,r,a,o,s,"throw",e)}o(void 0)})},function(){return r.apply(this,arguments)})},{key:"sendTestNotification",value:function(){try{new Notification("Todo App",{body:"通知が有効になりました！",icon:this.getNotificationIcon(),tag:"todo-app-test"})}catch(e){console.error("Test notification failed:",e)}}},{key:"getNotificationIcon",value:function(){return'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%235D5CDE"><path d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg>'}},{key:"startChecking",value:function(e){var t=this;this.intervalId&&this.stopChecking(),this.intervalId=setInterval(function(){try{var n=e();t.checkTaskDeadlines(n)}catch(e){console.error("Error checking task deadlines:",e)}},6e4)}},{key:"stopChecking",value:function(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}},{key:"checkTaskDeadlines",value:function(e){var t=this;if("granted"===this.permission){var n=new Date;e.filter(function(e){return!e.completed&&e.deadline}).forEach(function(e){try{var r=new Date(e.deadline);if(!p.isValidDate(r))return;var a=(r.getTime()-n.getTime())/36e5;a<=1&&a>0&&!t.notifiedTasks.has(e.id)?(t.sendTaskNotification(e,"1時間以内に締切です"),t.notifiedTasks.add(e.id)):a<=0&&a>-1&&!t.notifiedTasks.has("overdue_".concat(e.id))&&(t.sendTaskNotification(e,"締切を過ぎました"),t.notifiedTasks.add("overdue_".concat(e.id)))}catch(e){console.error("Error processing task notification:",e)}})}}},{key:"sendTaskNotification",value:function(e,t){try{new Notification("Todo App - ".concat(t),{body:p.escapeHtml(e.text),icon:this.getNotificationIcon(),tag:"task_".concat(e.id),requireInteraction:!0,actions:[{action:"complete",title:"完了"},{action:"dismiss",title:"閉じる"}]})}catch(e){console.error("Failed to send task notification:",e)}}},{key:"clearTaskNotifications",value:function(e){this.notifiedTasks.delete(e),this.notifiedTasks.delete("overdue_".concat(e))}},{key:"clearAllNotifications",value:function(){this.notifiedTasks.clear()}},{key:"getNotificationStats",value:function(){return{permission:this.permission,isChecking:null!==this.intervalId,notifiedTasksCount:this.notifiedTasks.size}}}],t&&U(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r}();function Q(e){return Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Q(e)}function q(e,t,n){return(t=Z(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function K(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i,o,s=[],l=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,a=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw a}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return J(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?J(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function $(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Z(r.key),r)}}function Z(e){var t=function(e){if("object"!=Q(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Q(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Q(t)?t:t+""}var X=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},t=[{key:"getTagClass",value:function(e){for(var t=e.toLowerCase(),n=0,r=Object.entries({仕事:"work",work:"work",会社:"work",個人:"personal",personal:"personal",プライベート:"personal",緊急:"urgent",urgent:"urgent",重要:"urgent",勉強:"study",study:"study",学習:"study",健康:"health",health:"health",運動:"health",買い物:"shopping",shopping:"shopping",購入:"shopping"});n<r.length;n++){var a=K(r[n],2),i=a[0],o=a[1];if(t.includes(i))return o}return"default"}},{key:"getStatusClasses",value:function(e){var t=e.getStatus();return q(q(q(q({},a,"task-overdue border-l-red-500 bg-red-50 dark:bg-red-900/20"),i,"task-due-soon border-l-orange-500 bg-orange-50 dark:bg-orange-900/20"),n,"task-completed opacity-75"),r,"")[t]||""}},{key:"getDeadlineClasses",value:function(e){var t=e.getStatus();return q(q(q(q({},a,"text-red-600 dark:text-red-400"),i,"text-orange-600 dark:text-orange-400"),n,"text-gray-500 dark:text-gray-400"),r,"text-gray-500 dark:text-gray-400")[t]||"text-gray-500 dark:text-gray-400"}},{key:"createTaskElement",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.isEditing,r=void 0!==n&&n,a=t.onToggle,i=void 0===a?function(){}:a,o=t.onEdit,s=void 0===o?function(){}:o,l=t.onSave,c=void 0===l?function(){}:l,u=t.onCancel,d=void 0===u?function(){}:u,f=t.onDelete,h=void 0===f?function(){}:f,v=p.createElement("div","task-item bg-gray-50 dark:bg-gray-800 rounded-lg p-4 transition-all duration-200 hover:shadow-md border-l-4 ".concat(this.getStatusClasses(e)),{"data-task-id":e.id,role:"listitem","aria-label":"タスク: ".concat(e.text)}),y=p.createElement("div","flex items-start gap-3"),m=this.createCheckboxElement(e,i);y.appendChild(m);var g=p.createElement("div","flex-1 min-w-0");r?g.appendChild(this.createEditModeContent(e,c,d)):g.appendChild(this.createViewModeContent(e)),y.appendChild(g);var b=this.createActionButtons(e,r,s,h);return y.appendChild(b),v.appendChild(y),v}},{key:"createCheckboxElement",value:function(e,t){var n=p.createElement("label","flex items-center cursor-pointer"),r=p.createElement("input","checkbox-custom mt-1",{type:"checkbox","aria-label":"".concat(e.text,"を").concat(e.completed?"未完了":"完了","にする")});r.checked=e.completed,r.addEventListener("change",function(){return t(e.id)});var a=p.createElement("span","sr-only");return a.textContent=e.completed?"完了済み":"未完了",n.appendChild(r),n.appendChild(a),n}},{key:"createViewModeContent",value:function(e){var t=p.createElement("div"),n=p.createElement("span","block text-base transition-all duration-200 ".concat(e.completed?"line-through text-gray-500 dark:text-gray-400":"text-gray-900 dark:text-white"));if(n.textContent=e.text,t.appendChild(n),e.tags.length>0){var r=this.createTagsContainer(e.tags);t.appendChild(r)}var a=e.formatDeadline();if(a){var i=this.createDeadlineContainer(e,a);t.appendChild(i)}return t}},{key:"createTagsContainer",value:function(e){var t=this,n=p.createElement("div","mt-2 flex flex-wrap",{role:"list","aria-label":"タグ"});return e.forEach(function(e){var r=p.createElement("span","inline-flex items-center px-2 py-1 text-xs font-medium rounded-full mr-1 mb-1 tag-".concat(t.getTagClass(e)),{role:"listitem","aria-label":"タグ: ".concat(e)});r.textContent=e,n.appendChild(r)}),n}},{key:"createDeadlineContainer",value:function(e,t){var n=p.createElement("div","mt-1 flex items-center gap-1"),r=p.createElement("svg","w-4 h-4 ".concat(this.getDeadlineClasses(e)),{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"});r.innerHTML='<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>';var a=p.createElement("span","text-sm ".concat(this.getDeadlineClasses(e)),{"aria-label":"締切: ".concat(t)});return a.textContent=t,n.appendChild(r),n.appendChild(a),n}},{key:"createEditModeContent",value:function(e,t,n){var r=p.createElement("div","edit-mode border-2 border-primary rounded p-3 -m-3",{role:"form","aria-label":"タスクを編集"}),a=p.createElement("label","sr-only",{for:"edit-text-".concat(e.id)});a.textContent="タスク名";var i=p.createElement("input","w-full text-base font-normal border-none outline-none bg-transparent ".concat(e.completed?"line-through text-gray-500 dark:text-gray-400":"text-gray-900 dark:text-white"),{id:"edit-text-".concat(e.id),type:"text",value:e.text,maxlength:"200"}),o=p.createElement("label","sr-only",{for:"edit-tags-".concat(e.id)});o.textContent="タグ";var s=p.createElement("input","w-full text-sm text-gray-600 dark:text-gray-400 mt-1 border-none outline-none bg-transparent",{id:"edit-tags-".concat(e.id),type:"text",placeholder:"タグ（カンマ区切り）",value:e.tags.join(", "),maxlength:"100"}),l=p.createElement("label","sr-only",{for:"edit-deadline-".concat(e.id)});l.textContent="締切日時";var c=p.createElement("input","w-full text-sm text-gray-600 dark:text-gray-400 mt-1 border-none outline-none bg-transparent",{id:"edit-deadline-".concat(e.id),type:"datetime-local",value:e.deadline||""}),u=p.createElement("div","flex gap-2 mt-2"),d=p.createElement("button","px-3 py-1 bg-green-600 hover:bg-green-700 text-white text-sm rounded transition-colors",{"aria-label":"変更を保存"});d.textContent="保存",d.addEventListener("click",function(){var n={text:i.value.trim(),tags:p.parseTagString(s.value),deadline:c.value||null};t(e.id,n)});var f=p.createElement("button","px-3 py-1 bg-gray-600 hover:bg-gray-700 text-white text-sm rounded transition-colors",{"aria-label":"編集をキャンセル"});return f.textContent="キャンセル",f.addEventListener("click",n),u.appendChild(d),u.appendChild(f),r.appendChild(a),r.appendChild(i),r.appendChild(o),r.appendChild(s),r.appendChild(l),r.appendChild(c),r.appendChild(u),r}},{key:"createActionButtons",value:function(e,t,n,r){var a=p.createElement("div","flex gap-1 flex-shrink-0");if(!t){var i=p.createElement("button","text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 p-2 rounded transition-colors duration-200",{"aria-label":"".concat(e.text,"を編集")});i.innerHTML='<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>',i.addEventListener("click",function(){return n(e.id)}),a.appendChild(i)}var o=p.createElement("button","text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 p-2 rounded transition-colors duration-200",{"aria-label":"".concat(e.text,"を削除")});return o.innerHTML='<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>',o.addEventListener("click",function(){return r(e.id)}),a.appendChild(o),a}},{key:"renderTaskList",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t)throw new Error("Container element is required");if(t.innerHTML="",0!==e.length)e.forEach(function(e){var a=n.createTaskElement(e,r);t.appendChild(a)});else{var a=this.createEmptyState();t.appendChild(a)}}},{key:"createEmptyState",value:function(){var e=p.createElement("div","text-center py-12 text-gray-500 dark:text-gray-400",{role:"status"}),t=p.createElement("svg","w-16 h-16 mx-auto mb-4 opacity-50",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"});t.innerHTML='<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>';var n=p.createElement("p","text-lg");n.textContent="タスクがありません";var r=p.createElement("p","text-sm mt-1");return r.textContent="上のフォームから新しいタスクを追加してください",e.appendChild(t),e.appendChild(n),e.appendChild(r),e}}],null&&$(e.prototype,null),t&&$(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function W(e){return W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},W(e)}function Y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ee(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(n),!0).forEach(function(t){te(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Y(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function te(e,t,n){return(t=oe(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ne(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function i(n,r,a,i){var l=r&&r.prototype instanceof s?r:s,c=Object.create(l.prototype);return re(c,"_invoke",function(n,r,a){var i,s,l,c=0,u=a||[],d=!1,f={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,n){return i=t,s=0,l=e,f.n=n,o}};function h(n,r){for(s=n,l=r,t=0;!d&&c&&!a&&t<u.length;t++){var a,i=u[t],h=f.p,p=i[2];n>3?(a=p===r)&&(l=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=h&&((a=n<2&&h<i[1])?(s=0,f.v=r,f.n=i[1]):h<p&&(a=n<3||i[0]>r||r>p)&&(i[4]=n,i[5]=r,f.n=p,s=0))}if(a||n>1)return o;throw d=!0,r}return function(a,u,p){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&h(u,p),s=u,l=p;(t=s<2?e:l)||!d;){i||(s?s<3?(s>1&&(f.n=-1),h(s,l)):f.n=l:f.v=l);try{if(c=2,i){if(s||(a="next"),t=i[a]){if(!(t=t.call(i,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(l=TypeError("The iterator does not provide a '"+a+"' method"),s=1);i=e}else if((t=(d=f.n<0)?l:n.call(r,f))!==o)break}catch(t){i=e,s=1,l=t}finally{c=1}}return{value:t,done:d}}}(n,a,i),!0),c}var o={};function s(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(re(t={},r,function(){return this}),t),d=c.prototype=s.prototype=Object.create(u);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,re(e,a,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=c,re(d,"constructor",c),re(c,"constructor",l),l.displayName="GeneratorFunction",re(c,a,"GeneratorFunction"),re(d),re(d,a,"Generator"),re(d,r,function(){return this}),re(d,"toString",function(){return"[object Generator]"}),(ne=function(){return{w:i,m:f}})()}function re(e,t,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}re=function(e,t,n,r){if(t)a?a(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var i=function(t,n){re(e,t,function(e){return this._invoke(t,n,e)})};i("next",0),i("throw",1),i("return",2)}},re(e,t,n,r)}function ae(e,t,n,r,a,i,o){try{var s=e[i](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,a)}function ie(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,oe(r.key),r)}}function oe(e){var t=function(e){if("object"!=W(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=W(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==W(t)?t:t+""}var se,le=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.taskService=new D,this.filterService=new N,this.notificationService=new G,this.editingTaskId=null,this.previousFocus=null,this.isLoading=!1,this.cleanupFunctions=[],this.initializeElements(),this.bindEvents(),this.setupKeyboardShortcuts(),this.setupNotifications(),this.render(),this.startNotificationChecking()},t=[{key:"initializeElements",value:function(){var e=this;try{this.elements={taskInput:document.getElementById("taskInput"),tagInput:document.getElementById("tagInput"),deadlineInput:document.getElementById("deadlineInput"),addTaskBtn:document.getElementById("addTaskBtn"),searchInput:document.getElementById("searchInput"),sortSelect:document.getElementById("sortSelect"),filterBtns:document.querySelectorAll("[data-filter]"),tagFilters:document.getElementById("tagFilters"),taskList:document.getElementById("taskList"),emptyState:document.getElementById("emptyState"),taskCount:document.getElementById("taskCount"),completedCount:document.getElementById("completedCount"),overdueCount:document.getElementById("overdueCount"),clearCompletedBtn:document.getElementById("clearCompleted"),helpModal:document.getElementById("helpModal"),notificationBanner:document.getElementById("notificationBanner")};var t=["taskInput","taskList"].filter(function(t){return!e.elements[t]});if(t.length>0)throw new Error("必要なHTML要素が見つかりません: ".concat(t.join(", ")))}catch(e){throw y.handleError(e,"initializeElements"),e}}},{key:"bindEvents",value:function(){var e=this;try{var t,n,r,a,i,o,s,l,c;this.taskService.on("tasksChanged",function(){return e.render()}),this.taskService.on("taskAdded",function(t){var n;y.showSuccess("タスクを追加しました"),e.clearForm(),null===(n=e.elements.taskInput)||void 0===n||n.focus()}),this.taskService.on("taskUpdated",function(t){t.completed?(e.notificationService.clearTaskNotifications(t.id),y.showSuccess("タスクを完了しました")):y.showSuccess("タスクを更新しました")}),this.taskService.on("taskDeleted",function(t){var n=t.task;e.notificationService.clearTaskNotifications(n.id),y.showSuccess("タスクを削除しました")});var u=document.getElementById("addTaskForm");null==u||u.addEventListener("submit",function(t){t.preventDefault(),e.handleAddTask()}),this.elements.filterBtns.forEach(function(t){t.addEventListener("click",function(t){var n=t.target.dataset.filter;e.handleFilterChange(n)})}),null===(t=this.elements.searchInput)||void 0===t||t.addEventListener("input",p.debounce(function(t){return e.handleSearchChange(t.target.value)},300)),null===(n=this.elements.sortSelect)||void 0===n||n.addEventListener("change",function(t){return e.handleSortChange(t.target.value)}),null===(r=this.elements.clearCompletedBtn)||void 0===r||r.addEventListener("click",function(){return e.handleClearCompleted()}),null===(a=document.getElementById("allowNotifications"))||void 0===a||a.addEventListener("click",function(){return e.handleAllowNotifications()}),null===(i=document.getElementById("denyNotifications"))||void 0===i||i.addEventListener("click",function(){return e.hideNotificationBanner()}),null===(o=document.getElementById("helpBtn"))||void 0===o||o.addEventListener("click",function(){return e.showHelpModal()}),null===(s=document.getElementById("closeHelpModal"))||void 0===s||s.addEventListener("click",function(){return e.hideHelpModal()}),null===(l=this.elements.helpModal)||void 0===l||l.addEventListener("click",function(t){t.target===e.elements.helpModal&&e.hideHelpModal()}),null===(c=this.elements.taskInput)||void 0===c||c.addEventListener("input",function(t){return e.validateTaskInput(t.target)})}catch(e){y.handleError(e,"bindEvents")}}},{key:"setupKeyboardShortcuts",value:function(){var e=this,t=function(t){var n,r;try{if("INPUT"===t.target.tagName||"TEXTAREA"===t.target.tagName)return void("Escape"===t.key&&(t.target.blur(),t.preventDefault()));var a=t.key.toLowerCase();if(t.ctrlKey||t.metaKey)switch(a){case"n":t.preventDefault(),null===(n=e.elements.taskInput)||void 0===n||n.focus();break;case"f":t.preventDefault(),null===(r=e.elements.searchInput)||void 0===r||r.focus();break;case"a":t.preventDefault(),e.handleFilterChange(o.ALL);break;case"1":t.preventDefault(),e.handleFilterChange(o.ACTIVE);break;case"2":t.preventDefault(),e.handleFilterChange(o.COMPLETED);break;case"3":t.preventDefault(),e.handleFilterChange(o.OVERDUE)}else switch(a){case"?":t.preventDefault(),e.showHelpModal();break;case"escape":e.hideHelpModal(),e.editingTaskId&&e.handleCancelEdit()}}catch(e){y.handleError(e,"keyboard shortcuts")}};document.addEventListener("keydown",t),this.cleanupFunctions.push(function(){document.removeEventListener("keydown",t)})}},{key:"setupNotifications",value:function(){try{"Notification"in window&&"default"===Notification.permission&&this.showNotificationBanner()}catch(e){y.handleError(e,"setupNotifications")}}},{key:"showNotificationBanner",value:function(){var e=this;setTimeout(function(){var t;null===(t=e.elements.notificationBanner)||void 0===t||t.classList.add("show")},1e3)}},{key:"hideNotificationBanner",value:function(){var e;null===(e=this.elements.notificationBanner)||void 0===e||e.classList.remove("show")}},{key:"handleAllowNotifications",value:(n=ne().m(function e(){var t;return ne().w(function(e){for(;;)switch(e.n){case 0:return e.p=0,e.n=1,this.notificationService.requestPermission();case 1:"granted"===e.v?(this.hideNotificationBanner(),y.showSuccess("通知が有効になりました！")):(this.hideNotificationBanner(),y.showError("通知が拒否されました")),e.n=3;break;case 2:e.p=2,t=e.v,y.handleError(t,"handleAllowNotifications"),this.hideNotificationBanner();case 3:return e.a(2)}},e,this,[[0,2]])}),r=function(){var e=this,t=arguments;return new Promise(function(r,a){var i=n.apply(e,t);function o(e){ae(i,r,a,o,s,"next",e)}function s(e){ae(i,r,a,o,s,"throw",e)}o(void 0)})},function(){return r.apply(this,arguments)})},{key:"startNotificationChecking",value:function(){var e=this;this.notificationService.startChecking(function(){return e.taskService.getTasks()})}},{key:"showHelpModal",value:function(){try{this.previousFocus=document.activeElement,this.elements.helpModal.classList.add("show"),document.body.style.overflow="hidden";var e=m.trapFocus(this.elements.helpModal);this.cleanupFunctions.push(e)}catch(e){y.handleError(e,"showHelpModal")}}},{key:"hideHelpModal",value:function(){try{this.elements.helpModal.classList.remove("show"),document.body.style.overflow="",m.restoreFocus(this.previousFocus)}catch(e){y.handleError(e,"hideHelpModal")}}},{key:"validateTaskInput",value:function(e){var t=document.getElementById("taskInputError");return e.value.trim().length>200?(t.textContent="タスク名は".concat(200,"文字以内で入力してください"),t.classList.remove("hidden"),this.elements.addTaskBtn.disabled=!0,!1):(t.classList.add("hidden"),this.elements.addTaskBtn.disabled=!1,!0)}},{key:"setLoading",value:function(e){this.isLoading=e,this.elements.addTaskBtn&&(this.elements.addTaskBtn.disabled=e,this.elements.addTaskBtn.classList.toggle("loading",e))}},{key:"clearForm",value:function(){this.elements.taskInput&&(this.elements.taskInput.value=""),this.elements.tagInput&&(this.elements.tagInput.value=""),this.elements.deadlineInput&&(this.elements.deadlineInput.value="")}},{key:"handleAddTask",value:function(){if(!this.isLoading)try{var e=p.sanitizeInput(this.elements.taskInput.value);if(!e)return y.showError("タスク名を入力してください"),void this.elements.taskInput.focus();if(!this.validateTaskInput(this.elements.taskInput))return;this.setLoading(!0);var t=this.elements.deadlineInput.value||null,n=p.parseTagString(this.elements.tagInput.value);if(t&&new Date(t)<=new Date)return void y.showError("締切日時は未来の日時を指定してください");this.taskService.addTask({text:e,deadline:t,tags:n})}catch(e){y.handleError(e,"handleAddTask")}finally{this.setLoading(!1)}}},{key:"handleToggleTask",value:function(e){try{this.taskService.toggleTask(e)}catch(e){y.handleError(e,"handleToggleTask")}}},{key:"handleEditTask",value:function(e){this.editingTaskId=e,this.render()}},{key:"handleSaveEdit",value:function(e,t){try{var n=p.sanitizeInput(t.text);if(!n)return void y.showError("タスク名を入力してください");this.taskService.updateTask(e,{text:n,tags:t.tags,deadline:t.deadline}),this.editingTaskId=null}catch(e){y.handleError(e,"handleSaveEdit")}}},{key:"handleCancelEdit",value:function(){this.editingTaskId=null,this.render()}},{key:"handleDeleteTask",value:function(e){var t=this;try{var n=document.querySelector('[data-task-id="'.concat(e,'"]'));n&&(n.classList.add("task-exit"),setTimeout(function(){t.taskService.deleteTask(e)},300))}catch(e){y.handleError(e,"handleDeleteTask")}}},{key:"handleFilterChange",value:function(e){try{this.filterService.setFilter(e),this.updateFilterButtons(),this.render()}catch(e){y.handleError(e,"handleFilterChange")}}},{key:"handleSortChange",value:function(e){try{this.filterService.setSortBy(e),this.render()}catch(e){y.handleError(e,"handleSortChange")}}},{key:"handleSearchChange",value:function(e){try{this.filterService.setSearchQuery(e),this.render()}catch(e){y.handleError(e,"handleSearchChange")}}},{key:"handleTagFilterChange",value:function(e){try{this.filterService.setTagFilter(e),this.render()}catch(e){y.handleError(e,"handleTagFilterChange")}}},{key:"handleClearCompleted",value:function(){try{0===this.taskService.clearCompleted()&&y.showError("完了済みタスクがありません")}catch(e){y.handleError(e,"handleClearCompleted")}}},{key:"updateFilterButtons",value:function(){var e=this;this.elements.filterBtns.forEach(function(t){var n=t.dataset.filter===e.filterService.currentFilter;t.setAttribute("aria-pressed",n.toString())})}},{key:"render",value:function(){try{var e=this.taskService.getTasks(),t=this.filterService.filterTasks(e);this.renderStats(e),this.renderTagFilters(),this.renderTaskList(t),this.updateSortSelect()}catch(e){y.handleError(e,"render")}}},{key:"renderStats",value:function(e){var t=this.taskService.getStats();this.elements.taskCount&&(this.elements.taskCount.textContent=t.total),this.elements.completedCount&&(this.elements.completedCount.textContent=t.completed),this.elements.overdueCount&&(this.elements.overdueCount.textContent=t.overdue),this.elements.clearCompletedBtn&&this.elements.clearCompletedBtn.classList.toggle("hidden",0===t.completed)}},{key:"renderTagFilters",value:function(){var e=this;if(this.elements.tagFilters){var t=this.taskService.getAllTags();this.elements.tagFilters.innerHTML=t.map(function(t){var n=p.escapeHtml(t),r=e.filterService.currentTagFilter===t;return'\n                <button \n                    class="tag tag-'.concat(X.getTagClass(t)," ").concat(r?"ring-2 ring-primary":"",' cursor-pointer transition-all duration-200 hover:scale-105"\n                    data-tag="').concat(n,'"\n                    aria-pressed="').concat(r,'"\n                    aria-label="タグ ').concat(n,' でフィルター"\n                >\n                    ').concat(n,"\n                    ").concat(r?"✕":"","\n                </button>\n            ")}).join(""),this.elements.tagFilters.querySelectorAll("[data-tag]").forEach(function(t){t.addEventListener("click",function(t){var n=t.target.dataset.tag;e.handleTagFilterChange(n)})})}}},{key:"renderTaskList",value:function(e){var t=this;if(this.elements.taskList){var n={onToggle:function(e){return t.handleToggleTask(e)},onEdit:function(e){return t.handleEditTask(e)},onSave:function(e,n){return t.handleSaveEdit(e,n)},onCancel:function(){return t.handleCancelEdit()},onDelete:function(e){return t.handleDeleteTask(e)}};if(this.elements.taskList.innerHTML="",0!==e.length)e.forEach(function(e){var r=t.editingTaskId===e.id,a=X.createTaskElement(e,ee(ee({},n),{},{isEditing:r}));t.elements.taskList.appendChild(a)});else{var r=X.createEmptyState();this.elements.taskList.appendChild(r)}}}},{key:"updateSortSelect",value:function(){this.elements.sortSelect&&(this.elements.sortSelect.value=this.filterService.sortBy)}},{key:"destroy",value:function(){try{this.notificationService.stopChecking(),this.cleanupFunctions.forEach(function(e){return e()}),this.cleanupFunctions=[]}catch(e){console.error("Cleanup error:",e)}}}],t&&ie(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r}();window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&document.documentElement.classList.add("dark"),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",function(e){document.documentElement.classList.toggle("dark",e.matches)});try{var ce=document.getElementById("app");if(!ce)throw new Error("App container not found");ce.innerHTML='\n    \x3c!-- Error Alert --\x3e\n    <div id="errorAlert" class="fixed top-4 left-1/2 transform -translate-x-1/2 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded shadow-lg z-50 hidden" role="alert">\n        <div class="flex items-center">\n            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">\n                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>\n            </svg>\n            <span id="errorMessage">エラーが発生しました</span>\n        </div>\n    </div>\n\n    \x3c!-- Success Alert --\x3e\n    <div id="successAlert" class="fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded shadow-lg z-50 hidden" role="alert">\n        <div class="flex items-center">\n            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">\n                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>\n            </svg>\n            <span id="successMessage">操作が完了しました</span>\n        </div>\n    </div>\n\n    \x3c!-- Notification Permission Banner --\x3e\n    <div id="notificationBanner" class="notification-banner hidden" role="banner">\n        <div class="flex items-start gap-3">\n            <svg class="w-5 h-5 text-blue-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">\n                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM12 13a3 3 0 100-6 3 3 0 000 6zm0 0v6a9 9 0 009-9H12z"></path>\n            </svg>\n            <div class="flex-1">\n                <p class="text-sm font-medium text-blue-800 dark:text-blue-200 mb-2">通知を許可</p>\n                <p class="text-xs text-blue-700 dark:text-blue-300 mb-3">締切が近づいたタスクの通知を受け取るには、ブラウザの通知を許可してください。</p>\n                <div class="flex gap-2">\n                    <button id="allowNotifications" class="px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white text-xs rounded transition-colors" aria-label="通知を許可">許可</button>\n                    <button id="denyNotifications" class="px-3 py-1 bg-gray-300 hover:bg-gray-400 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-700 dark:text-gray-300 text-xs rounded transition-colors" aria-label="通知を後で設定">後で</button>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <div class="min-h-screen p-4 md:p-8">\n        <div class="max-w-md mx-auto">\n            \x3c!-- Header --\x3e\n            <header class="text-center mb-8">\n                <h1 class="text-3xl md:text-4xl font-bold text-primary mb-2">Todo App</h1>\n                <p class="text-gray-600 dark:text-gray-400">タスクを管理して生産性を向上させましょう</p>\n            </header>\n\n            \x3c!-- Add Task Form --\x3e\n            <form id="addTaskForm" class="mb-8" role="form" aria-labelledby="add-task-heading">\n                <h2 id="add-task-heading" class="sr-only">新しいタスクを追加</h2>\n                <div class="space-y-4">\n                    <div>\n                        <label for="taskInput" class="sr-only">タスク名</label>\n                        <input \n                            type="text" \n                            id="taskInput" \n                            placeholder="新しいタスクを入力... (Ctrl+N)"\n                            class="form-input"\n                            required\n                            aria-describedby="task-help"\n                            maxlength="200"\n                        >\n                        <div id="task-help" class="sr-only">タスクの名前を入力してください。最大200文字まで。</div>\n                        <div id="taskInputError" class="error-message hidden"></div>\n                    </div>\n                    <div>\n                        <label for="tagInput" class="sr-only">タグ</label>\n                        <input \n                            type="text" \n                            id="tagInput" \n                            placeholder="タグを入力（カンマ区切りで複数可）例: 仕事, 緊急"\n                            class="form-input"\n                            aria-describedby="tag-help"\n                            maxlength="100"\n                        >\n                        <div id="tag-help" class="sr-only">タスクのタグをカンマ区切りで入力してください。</div>\n                    </div>\n                    <div class="input-group">\n                        <div class="input-field">\n                            <label for="deadlineInput" class="sr-only">締切日時</label>\n                            <input \n                                type="datetime-local" \n                                id="deadlineInput" \n                                class="form-input"\n                                aria-describedby="deadline-help"\n                            >\n                            <div id="deadline-help" class="sr-only">タスクの締切日時を設定してください。</div>\n                        </div>\n                        <button \n                            type="submit"\n                            id="addTaskBtn"\n                            class="form-button submit-button"\n                            aria-label="タスクを追加"\n                        >\n                            追加\n                        </button>\n                    </div>\n                    <p class="text-xs text-gray-500 dark:text-gray-400">締切日時とタグは任意です</p>\n                </div>\n            </form>\n\n            \x3c!-- Search Box --\x3e\n            <div class="mb-4">\n                <div class="relative">\n                    <label for="searchInput" class="sr-only">タスクを検索</label>\n                    <input \n                        type="text" \n                        id="searchInput" \n                        placeholder="タスクを検索... (Ctrl+F)"\n                        class="form-input pl-10"\n                        aria-describedby="search-help"\n                    >\n                    <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">\n                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>\n                    </svg>\n                    <div id="search-help" class="sr-only">タスク名やタグで検索できます。</div>\n                </div>\n            </div>\n\n            \x3c!-- Sort Options --\x3e\n            <div class="mb-4">\n                <label for="sortSelect" class="sr-only">並び順を選択</label>\n                <select id="sortSelect" class="form-select" aria-label="タスクの並び順">\n                    <option value="created-desc">作成日時 (新しい順)</option>\n                    <option value="created-asc">作成日時 (古い順)</option>\n                    <option value="deadline-asc">締切日時 (近い順)</option>\n                    <option value="deadline-desc">締切日時 (遠い順)</option>\n                    <option value="name-asc">タスク名 (A-Z)</option>\n                    <option value="name-desc">タスク名 (Z-A)</option>\n                    <option value="status-asc">完了状況 (未完了→完了)</option>\n                    <option value="status-desc">完了状況 (完了→未完了)</option>\n                </select>\n            </div>\n\n            \x3c!-- Filter Buttons --\x3e\n            <div class="flex flex-wrap gap-2 mb-4" role="group" aria-label="タスクフィルター">\n                <button class="filter-btn" aria-pressed="true" data-filter="all">すべて</button>\n                <button class="filter-btn" aria-pressed="false" data-filter="active">未完了</button>\n                <button class="filter-btn" aria-pressed="false" data-filter="completed">完了済み</button>\n                <button class="filter-btn" aria-pressed="false" data-filter="overdue">期限切れ</button>\n            </div>\n\n            \x3c!-- Tag Filters --\x3e\n            <div id="tagFilters" class="flex flex-wrap gap-2 mb-6" role="group" aria-label="タグフィルター">\n                \x3c!-- Tag filter buttons will be dynamically added here --\x3e\n            </div>\n\n            \x3c!-- Task Count --\x3e\n            <div class="mb-4" role="status" aria-live="polite">\n                <p class="text-sm text-gray-600 dark:text-gray-400">\n                    <span id="taskCount">0</span> 個のタスク\n                    (<span id="completedCount">0</span> 完了, <span id="overdueCount">0</span> 期限切れ)\n                </p>\n            </div>\n\n            \x3c!-- Task List --\x3e\n            <div id="taskList" class="space-y-3" role="list" aria-label="タスク一覧">\n                \x3c!-- Tasks will be dynamically added here --\x3e\n            </div>\n\n            \x3c!-- Clear Completed Button --\x3e\n            <div class="mt-6 text-center">\n                <button \n                    id="clearCompleted" \n                    class="px-4 py-2 text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 font-medium transition-colors duration-200 hidden"\n                    aria-label="完了済みタスクを削除"\n                >\n                    完了済みタスクを削除\n                </button>\n            </div>\n\n            \x3c!-- Keyboard Shortcuts Help --\x3e\n            <div class="mt-6 text-center">\n                <button id="helpBtn" class="text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors" aria-label="キーボードショートカットを表示">\n                    ⌨️ キーボードショートカット (?)\n                </button>\n            </div>\n        </div>\n    </div>\n\n    \x3c!-- Help Modal --\x3e\n    <div id="helpModal" class="modal" role="dialog" aria-labelledby="helpModalTitle" aria-modal="true">\n        <div class="modal-content">\n            <div class="flex justify-between items-center mb-4">\n                <h2 id="helpModalTitle" class="text-xl font-bold">⌨️ キーボードショートカット</h2>\n                <button id="closeHelpModal" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200" aria-label="ヘルプを閉じる">✕</button>\n            </div>\n            <dl class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">\n                <div class="flex justify-between py-1">\n                    <dt class="font-mono bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded text-xs">Ctrl + N</dt>\n                    <dd class="ml-2">新しいタスクを追加</dd>\n                </div>\n                <div class="flex justify-between py-1">\n                    <dt class="font-mono bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded text-xs">Ctrl + F</dt>\n                    <dd class="ml-2">検索にフォーカス</dd>\n                </div>\n                <div class="flex justify-between py-1">\n                    <dt class="font-mono bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded text-xs">Ctrl + A</dt>\n                    <dd class="ml-2">すべてのタスクを表示</dd>\n                </div>\n                <div class="flex justify-between py-1">\n                    <dt class="font-mono bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded text-xs">Ctrl + 1</dt>\n                    <dd class="ml-2">未完了タスクを表示</dd>\n                </div>\n                <div class="flex justify-between py-1">\n                    <dt class="font-mono bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded text-xs">Ctrl + 2</dt>\n                    <dd class="ml-2">完了済みタスクを表示</dd>\n                </div>\n                <div class="flex justify-between py-1">\n                    <dt class="font-mono bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded text-xs">Ctrl + 3</dt>\n                    <dd class="ml-2">期限切れタスクを表示</dd>\n                </div>\n                <div class="flex justify-between py-1">\n                    <dt class="font-mono bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded text-xs">?</dt>\n                    <dd class="ml-2">このヘルプを表示</dd>\n                </div>\n                <div class="flex justify-between py-1">\n                    <dt class="font-mono bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded text-xs">Esc</dt>\n                    <dd class="ml-2">モーダルを閉じる</dd>\n                </div>\n            </dl>\n            <div class="mt-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg">\n                <p class="font-semibold mb-2 text-sm">💡 使い方のヒント:</p>\n                <ul class="space-y-1 text-xs text-gray-600 dark:text-gray-400">\n                    <li>• 数字キーでフィルターを素早く切り替え</li>\n                    <li>• Ctrl+Nでいつでも新規タスク作成</li>\n                    <li>• Ctrl+Fで検索してタスクを素早く発見</li>\n                    <li>• Escキーで入力をキャンセル</li>\n                </ul>\n            </div>\n        </div>\n    </div>\n',se=new le,window.addEventListener("beforeunload",function(){se&&se.destroy()})}catch(e){y.handleError(e,"App initialization");var ue=document.getElementById("app");ue&&(ue.innerHTML='\n            <div class="flex items-center justify-center min-h-screen">\n                <div class="text-center">\n                    <h1 class="text-2xl font-bold text-red-600 mb-4">アプリケーションエラー</h1>\n                    <p class="text-gray-600 mb-4">アプリの初期化に失敗しました。</p>\n                    <button onclick="window.location.reload()" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-hover transition-colors">\n                        ページを再読み込み\n                    </button>\n                </div>\n            </div>\n        ')}})();